<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MarkingHub</title>
<style>
  :root{
    --cell: 200px; --gap: 60px;   /* шаг сетки */
    --w: 220px; --h: 120px;      /* размер узла */
    --stroke:#8a8a8a; --r:16px;  /* стиль линий/рамок */
    --toolbar-h: 164px;          /* высота фикс-панели (подгони при необходимости) */
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:#f6f8fa; font:14px/1.35 system-ui,Segoe UI,Arial;
    overflow-x:auto; min-height:100vh;
  }

  /* ===== Фикс-панель сверху ===== */
  .toolbar{
    position:fixed; top:0; left:0; right:0; z-index:9999;
    display:flex; flex-direction:column; align-items:center; gap:12px;
    padding:16px 20px; background:#fff;
    box-shadow:0 4px 20px rgba(0,0,0,.1);
    border-bottom:1px solid rgba(0,0,0,.06);
  }
  .toolbar-row{ display:flex; gap:20px; }
  .toolbar button{
    padding:14px 28px; background:#0056b3; color:#fff; border:none; border-radius:8px;
    font-size:15px; font-weight:600; cursor:pointer; transition:transform .2s, box-shadow .2s;
    box-shadow:0 2px 8px rgba(0,86,179,.3);
  }
  .toolbar button:hover{ transform:translateY(-2px); box-shadow:0 4px 16px rgba(0,0,0,.2); }
  .toolbar button:active{ transform:translateY(0); box-shadow:0 2px 4px rgba(0,0,0,.2); }
  .toolbar button.muted{ background:#6c757d; box-shadow:0 2px 8px rgba(108,117,125,.3); }

  /* ===== Контент ниже панели ===== */
  .main-wrap{
    display:flex; justify-content:center; align-items:flex-start;
    min-height:100vh; padding-top:var(--toolbar-h);
  }

  /* ===== Доска/схема ===== */
  #board{
    position:relative; width:1600px; height:1600px; max-width:95vw; max-height:200vh; border-radius:20px;
    background-image:
      linear-gradient(#ffffff00 1px,transparent 1px),
      linear-gradient(90deg,#ffffff00 1px,transparent 1px);
    background-size: calc(var(--cell)+var(--gap)) calc(var(--cell)+var(--gap));
    box-shadow: 0 6px 30px rgba(147, 147, 147, 0.12);
    margin: 0 auto 20px;
  }
  svg.wires{position:absolute; inset:0; pointer-events:none; z-index:0}

  .node{
    position:absolute; width:var(--w); height:var(--h); background:#fff;
    border:2px solid var(--stroke); border-radius:var(--r);
    display:flex; align-items:center; justify-content:center;
    font-weight:600; color:#3a3a3a; text-align:center;
    padding:2px; white-space:pre-wrap; word-wrap:break-word; word-break:break-word;
    overflow:hidden; line-height:1.5; font-size:16px;
    box-shadow:0 3px 12px rgba(0,0,0,.15);
  }
  /* исключения с меньшим размером текста */
  .node:not(#q1):not(#w1):not(#e1):not(#r1):not(#a1):not(#s1):not(#d1):not(#f1):not(#center) {
    font-size:12px;
  }
  /* Блоки с высотой 100px */
  #q1, #w1, #e1, #r1, #a1, #s1, #d1, #f1 { height:100px; }
  #q2, #w2, #e2, #r2, #a2, #s2, #d2, #f2 { height:100px; }
  /* Узкие блоки */
  #x1, #c1, #v1, #x2, #c2, #v2, #x3, #c3, #v3 { width:170px; }
</style>
</head>
<body>

<!-- ===== Фиксированная панель (не двигается при прокрутке) ===== -->
<div class="toolbar">
  <div class="toolbar-row">
    <button onclick="window.location.href='https://forms.clickup.com/9012004090/f/8cjgh7u-5532/GDFERC05MBEHE67XDW'">Проблемний товар</button>
  </div>
  <div class="toolbar-row">
    <button onclick="window.location.href='https://forms.clickup.com/9012004090/f/8cjgh7u-4372/JSP317572APJJHCKWI'">Створити товар (Надлишок)</button>
    <button onclick="window.location.href='https://forms.clickup.com/9012004090/f/8cjgh7u-4452/MYCVRASG1Y12PR9K5G'">Створити товар (Уцінка)</button>
  </div>
  <div class="toolbar-row">
    <button class="muted" onclick="window.location.href='https://forms.clickup.com/9012004090/f/8cjgh7u-4452/MYCVRASG1Y12PR9K5G'">Вільні артикули для уцінки</button>
  </div>
</div>

<!-- ===== Контент со схемой ===== -->
<div class="main-wrap">
  <div id="board">
    <svg class="wires" id="wires"></svg>

    <!-- ВЕРХ (выровнано по колонкам) -->
    <div class="node" id="q2" style="left: 230px;  top:250px;">Після завершення натискаємо кнопку "Провести та закрити"</div>
    <div class="node" id="w2" style="left: 490px; top:250px;">Після завершення натискаємо кнопку "Провести"</div>
    <div class="node" id="e3" style="left: 750px; top:110px;">Надрукувати артикул та внести його в 1С: кнопка "Оприбуткувати надлишок" → кнопка (+) → вписати артикул і к-сть товару</div>
    <div class="node" id="r3" style="left: 1010px; top:110px;">Сповістити менеджера по закупках  (форма "Проблемний товар")</div>
    <div class="node" id="e2" style="left: 750px; top:250px;">Якщо товару прийшло більше ніж замовляли</div>
    <div class="node" id="r2" style="left: 1010px; top:250px;">Якщо товар вказаний в накладній, а по факту його немає (за умови що всі місця приїхали) </div>

    <div class="node" id="q1" style="left: 230px;  top:370px;">Якщо приїхали
всі місця</div>
    <div class="node" id="w1" style="left: 490px; top:370px;">Якщо ще чекаємо на товар</div>
    <div class="node" id="e1" style="left: 750px; top:370px;">Надлишок</div>
    <div class="node" id="r1" style="left: 1010px; top:370px;">Нестача</div>

    <div class="node" id="center" style="left: 630px; top:580px; width:280px; height:40px;">Маркування товарів</div>

    <!-- НИЖЕ center (строго по колонкам a/s/d/f) -->
    <div class="node" id="a1" style="left:230px; top:715px;">Товар пошкоджено</div>
    <div class="node" id="s1" style="left:490px; top:715px;">Не повний комплект</div>
    <div class="node" id="d1" style="left:750px; top:715px;">Товар на фото</div>
    <div class="node" id="f1" style="left:1010px; top:715px;">Прийшов не той товар</div>

    <div class="node" id="a2" style="left:230px; top:835px;">Брак при литті, подряпини, сколи
пошкодження кріплень тощо</div>
    <div class="node" id="s2" style="left:490px; top:835px;">Не повна комплектація (якщо на сайті постач. назва і фото без змін)</div>
    <div class="node" id="d2" style="left:750px; top:835px;">Синя підсвітка під час маркування</div>
    <div class="node" id="f2" style="left:1010px; top:835px;">Інший колір, характеристики, фото на сайті відрізняється з тим що прийшло по факту</div>

    <div class="node" id="z1" style="left:370px; top:960px;">Сповістити менеджера по закупках (форма "Проблемний товар")</div>
    <div class="node" id="f3" style="left:1010px; top:960px;">Сповістити менеджера по закупках (форма "Проблемний товар")</div>
    <div class="node" id="f4" style="left:1010px; top:1100px; width:220px; height:80px;">Комірка NT-1-001</div>

    <!-- Колонки x / c / v -->
    <div class="node" id="x1" style="left:195px; top:1100px;">Якщо вартість пошкодженого товару нижче 100 грн</div>
    <div class="node" id="c1" style="left:395px; top:1100px;">Якщо товар від постач, яким оформляється повернення: MCG (11), SKS (12), ANK (13), ТАТА (14)</div>
    <div class="node" id="v1" style="left:595px; top:1100px;">Якщо немає можливості зробити повернення заповнюємо форму "Створити уцінку"</div>

    <div class="node" id="x2" style="left:195px; top:1225px; height:80px;">Комірка "Запчастини < 100 грн" (без ТЗД)</div>
    <div class="node" id="c2" style="left:395px; top:1225px; height:80px;">Комірка "PO-1-001" або "NK-1-001" відповідно</div>
    <div class="node" id="v2" style="left:595px; top:1225px; height:80px;">Комірка "PН-1-001"</div>

    <div class="node" id="x3" style="left:195px; top:1310px; height:80px;">Утилізація</div>
    <div class="node" id="c3" style="left:395px; top:1310px; height:80px;">Повернення постачальнику</div>
    <div class="node" id="v3" style="left:595px; top:1310px; height:80px;">Продаж</div>
  </div>
</div>

<script>
const board = document.getElementById('board');
const svg   = document.getElementById('wires');

/* Рёбра — как на скрине */
const edges = [
  // верх → центр (со стрелками)
  ['center','q1'], ['center','w1'], ['center','e1'], ['center','r1'],
  // вертикали вверху
  ['q1','q2'], // со стрелками
  ['w1','w2'], // со стрелками
  ['e2','e3'], // без стрелок
  ['r2','r3'], // без стрелок
  // центр → ряд a/s/d/f (со стрелками)
  ['center','a1'], ['center','s1'], ['center','d1'], ['center','f1'],
  // вниз к z1 и правой цепочке f
  ['a2','z1'], // со стрелками
  ['s2','z1'], // со стрелками
  ['f2','f3'], // со стрелками
  ['f3','f4'], // со стрелками
  // L-образное соединение от d2 до v2 (без стрелок)
  ['d2','v2'],
  // разветвление от z1
  ['z1','x1'], // со стрелками
  ['z1','c1'], // со стрелками
  ['z1','v1'], // со стрелками
  ['x1','x2'], // без стрелок
  ['x2','x3'], // без стрелок
  ['z1','c2'], // без стрелок
  ['c1','c2'], // без стрелок
  ['c2','c3'], // без стрелок
  ['v1','v2'], // без стрелок
  ['v2','v3'], // без стрелок
];

function center(el){
  const a = el.getBoundingClientRect(), b = board.getBoundingClientRect();
  return { x: a.left - b.left + a.width/2, y: a.top - b.top + a.height/2 };
}

// простая прямая линия
function straight(A,B){
  const p1 = center(A), p2 = center(B);
  const d = `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y}`;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d', d);
  path.setAttribute('fill','none');
  path.setAttribute('stroke','var(--stroke)');
  path.setAttribute('stroke-width','2');
  path.setAttribute('stroke-linecap','round');
  path.setAttribute('stroke-opacity','0.95');
  return path;
}

// L-образная линия: вниз → влево/вправо
function lShapeReverse(A,B){
  const p1 = center(A), p2 = center(B);
  const d = `M ${p1.x} ${p1.y} L ${p1.x} ${p2.y} L ${p2.x} ${p2.y}`;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d', d);
  path.setAttribute('fill','none');
  path.setAttribute('stroke','var(--stroke)');
  path.setAttribute('stroke-width','2');
  path.setAttribute('stroke-linecap','round');
  path.setAttribute('stroke-opacity','0.95');
  return path;
}

// прямая линия со стрелкой ->
function straightWithArrow(A,B, customLength = 30){
  const p1 = center(A);
  const p2 = center(B);
  const dx = p2.x - p1.x;
  const dy = p2.y - p1.y;
  const angle = Math.atan2(dy, dx);

  const arrowDistance = customLength;
  const arrowX = p2.x - Math.cos(angle) * arrowDistance;
  const arrowY = p2.y - Math.sin(angle) * arrowDistance;

  const d = `M ${p1.x} ${p1.y} L ${arrowX} ${arrowY}`;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d', d);
  path.setAttribute('fill','none');
  path.setAttribute('stroke','var(--stroke)');
  path.setAttribute('stroke-width','2');
  path.setAttribute('stroke-linecap','round');
  path.setAttribute('stroke-opacity','0.95');

  const arrowPath = document.createElementNS('http://www.w3.org/2000/svg','path');
  const arrowD = `M ${arrowX} ${arrowY} L ${arrowX - 10 * Math.cos(angle - Math.PI/6)} ${arrowY - 10 * Math.sin(angle - Math.PI/6)}
                  M ${arrowX} ${arrowY} L ${arrowX - 10 * Math.cos(angle + Math.PI/6)} ${arrowY - 10 * Math.sin(angle + Math.PI/6)}`;
  arrowPath.setAttribute('d', arrowD);
  arrowPath.setAttribute('stroke','var(--stroke)');
  arrowPath.setAttribute('stroke-width','2');
  arrowPath.setAttribute('stroke-linecap','round');
  arrowPath.setAttribute('fill','none');
  arrowPath.setAttribute('stroke-opacity','0.95');

  return [path, arrowPath];
}

// L-образная линия со стрелкой ->
function lShapeReverseWithArrow(A,B, customLength = 30){
  const p1 = center(A);
  const p2 = center(B);
  const dx = p2.x - p1.x;
  const dy = p2.y - p1.y;
  const angle = Math.atan2(dy, dx);

  const arrowDistance = customLength;
  const arrowX = p2.x - Math.cos(angle) * arrowDistance;
  const arrowY = p2.y - Math.sin(angle) * arrowDistance;

  const d = `M ${p1.x} ${p1.y} L ${p1.x} ${arrowY} L ${arrowX} ${arrowY}`;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d', d);
  path.setAttribute('fill','none');
  path.setAttribute('stroke','var(--stroke)');
  path.setAttribute('stroke-width','2');
  path.setAttribute('stroke-linecap','round');
  path.setAttribute('stroke-opacity','0.95');

  const arrowPath = document.createElementNS('http://www.w3.org/2000/svg','path');
  const arrowD = `M ${arrowX} ${arrowY} L ${arrowX - 10 * Math.cos(angle - Math.PI/6)} ${arrowY - 10 * Math.sin(angle - Math.PI/6)}
                  M ${arrowX} ${arrowY} L ${arrowX - 10 * Math.cos(angle + Math.PI/6)} ${arrowY - 10 * Math.sin(angle + Math.PI/6)}`;
  arrowPath.setAttribute('d', arrowD);
  arrowPath.setAttribute('stroke','var(--stroke)');
  arrowPath.setAttribute('stroke-width','2');
  arrowPath.setAttribute('stroke-linecap','round');
  arrowPath.setAttribute('fill','none');
  arrowPath.setAttribute('stroke-opacity','0.95');

  return [path, arrowPath];
}

function draw(){
  const r = board.getBoundingClientRect();
  svg.setAttribute('viewBox',`0 0 ${r.width} ${r.height}`);
  svg.setAttribute('width', r.width);
  svg.setAttribute('height', r.height);
  while(svg.firstChild) svg.removeChild(svg.firstChild);

  // Кастомные длины стрелок для выравнивания на блоках
  const arrowLengths = {
    'center-q1': 115,
    'center-w1': 69,
    'center-e1': 56,
    'center-r1': 110,
    'q1-q2': 50,
    'w1-w2': 50,
    'center-a1': 115,
    'center-s1': 73,
    'center-d1': 57,
    'center-f1': 113,
    'a2-z1': 87,
    's2-z1': 81,
    'z1-x1': 97,
    'z1-c1': 60,
    'z1-v1': 97,
    'f2-f3': 61,
    'f3-f4': 40
  };

  edges.forEach(([a,b])=>{
    const A = document.getElementById(a), B = document.getElementById(b);
    if (!A || !B) return;

    const arrowConnections = new Set([
      'center-q1','center-w1','center-e1','center-r1',
      'q1-q2','w1-w2',
      'center-a1','center-s1','center-d1','center-f1',
      'a2-z1','s2-z1',
      'z1-x1','z1-c1','z1-v1',
      'f2-f3','f3-f4'
    ]);
    const key = `${a}-${b}`;

    if (arrowConnections.has(key)) {
      const customLength = arrowLengths[key] || 30;
      if (a === 'd2' && b === 'v2') {
        const [path, arrow] = lShapeReverseWithArrow(A,B, customLength);
        svg.appendChild(path); svg.appendChild(arrow);
      } else {
        const [path, arrow] = straightWithArrow(A,B, customLength);
        svg.appendChild(path); svg.appendChild(arrow);
      }
    } else {
      if (a === 'd2' && b === 'v2') {
        svg.appendChild(lShapeReverse(A,B));
      } else {
        svg.appendChild(straight(A,B));
      }
    }
  });
}

window.addEventListener('load', draw);
window.addEventListener('resize', draw);
new ResizeObserver(draw).observe(board);
</script>
</body>
</html>
